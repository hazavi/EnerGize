<div class="workout-container">
    <!-- Loading Indicator -->
    <app-loading *ngIf="isLoading"></app-loading>

    <!-- Main Content -->
    <div class="workout-content" *ngIf="!isLoading">
        <header class="workout-header">
            <h2 class="section-title">Weekly Workout Plan</h2>
        </header>

        <!-- Week Calendar View -->
        <div class="week-calendar">
            <!-- Day Cards for Each Day of the Week -->
            <div *ngFor="let day of weekDays" class="day-card" (click)="openDayZoom(day)">
                <!-- Day Header -->
                <div class="day-header" [ngClass]="{'today': isToday(day)}">
                    <h3 class="day-title">{{ day }}</h3>
                    <span class="day-date" *ngIf="isToday(day)">Today</span>
                </div>

                <!-- Workouts List for this Day -->
                <div class="workout-list">
                    <div *ngFor="let workout of getWorkoutsForDay(day)" class="workout-card"
                        (click)="$event.stopPropagation()">
                        <div class="workout-info">
                            <i class="fas fa-dumbbell workout-icon"></i>
                            <span class="workout-name">{{ workout?.name }}</span>
                        </div>

                        <!-- Workout Menu -->
                        <div class="menu-container">
                            <button class="btn btn-icon menu-toggle"
                                (click)="toggleWorkoutMenu(workout.id, $event); $event.stopPropagation()">
                                <i class="fas fa-ellipsis-vertical"></i>
                            </button>
                            <div class="menu-dropdown" *ngIf="menuOpenMap[workout.id]"
                                (click)="$event.stopPropagation()">
                                <button class="menu-item" (click)="renameWorkout(workout)">
                                    <i class="fas fa-edit"></i> Rename
                                </button>
                                <button class="menu-item delete-item"
                                    (click)="deleteWorkout(getDayTemplate(day), workout.id)">
                                    <i class="fas fa-trash-alt"></i> Delete
                                </button>
                                <button class="menu-item" (click)="addExerciseToWorkout(workout)">
                                    <i class="fas fa-plus"></i> Add Exercise
                                </button>
                            </div>
                        </div>

                        <!-- Exercises List (if available) -->
                        <div class="exercise-list" *ngIf="workout?.exercises?.length">
                            <div *ngFor="let exercise of workout?.exercises; let i = index" class="exercise-card">
                                <span class="exercise-name">Exercise ID: {{ exercise?.id }}</span>

                                <!-- Sets Section -->
                                <div class="sets-list">
                                    <div *ngFor="let set of setsMap[i]; let j = index" class="set-card">
                                        <span class="set-info">
                                            Set {{ j + 1 }}: {{ set.reps }} reps, {{ set.weight }} {{ set.weightUnit }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Add Workout Button -->
                    <button class="btn btn-add-workout"
                        (click)="addWorkout(getDayTemplate(day)); $event.stopPropagation()">
                        <i class="fas fa-plus"></i> Add Workout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Day Zoom Overlay -->
    <div class="day-zoom-overlay" *ngIf="zoomedDay" (click)="closeDayZoom()">
        <div class="day-zoom-container" (click)="$event.stopPropagation()">
            <div class="day-zoom-header" [ngClass]="{'today': isToday(zoomedDay)}">
                <h2>{{ zoomedDay }} Workouts</h2>
                <button class="close-zoom-btn" (click)="closeDayZoom()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="day-zoom-content">
                <!-- Workouts List for Zoomed Day -->
                <div class="workout-list">
                    <div *ngFor="let workout of getWorkoutsForDay(zoomedDay)" class="workout-card">
                        <div class="workout-info">
                            <i class="fas fa-dumbbell workout-icon"></i>
                            <span class="workout-name">{{ workout?.name }}</span>
                        </div>

                        <!-- Workout Menu -->
                        <div class="menu-container">
                            <button class="btn btn-icon menu-toggle" (click)="toggleWorkoutMenu(workout.id, $event)">
                                <i class="fas fa-ellipsis-vertical"></i>
                            </button>
                            <div class="menu-dropdown" *ngIf="menuOpenMap[workout.id]"
                                (click)="$event.stopPropagation()">
                                <button class="menu-item" (click)="renameWorkout(workout)">
                                    <i class="fas fa-edit"></i> Rename
                                </button>
                                <button class="menu-item delete-item"
                                    (click)="deleteWorkout(getDayTemplate(zoomedDay), workout.id)">
                                    <i class="fas fa-trash-alt"></i> Delete
                                </button>
                                <button class="menu-item" (click)="addExerciseToWorkout(workout)">
                                    <i class="fas fa-plus"></i> Add Exercise
                                </button>
                            </div>
                        </div>

                        <!-- Exercises List -->
                        <div class="exercise-list" *ngIf="workout?.exercises?.length">
                            <div *ngFor="let exercise of workout?.exercises; let i = index" class="exercise-card">
                                <span class="exercise-name">{{ exercise?.exercise_id !== undefined ? getExerciseName(exercise.exercise_id) : 'Unknown Exercise' }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Add Workout Button -->
                    <button class="btn btn-add-workout"
                        (click)="addWorkout(getDayTemplate(zoomedDay)); $event.stopPropagation()">
                        <i class="fas fa-plus"></i> Add Workout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Workout Modal -->
    <app-workout-modal [isOpen]="isWorkoutModalOpen" [selectedWorkout]="selectedWorkout"
        [workoutExercises]="workoutExercises" (close)="closeWorkoutModal()"
        (save)="saveWorkout($event)"></app-workout-modal>
</div>